#!/bin/bash

# Deploy blue and green
kubectl apply -f blue_deployment.yaml
kubectl apply -f green_deployment.yaml
kubectl apply -f kubeservice.yaml

# Wait for green deployment to be ready
kubectl rollout status deployment/messaging-app-green

# Check logs of green pods
GREEN_PODS=$(kubectl get pods -l app=messaging-app,version=green -o jsonpath='{.items[*].metadata.name}')
for pod in $GREEN_PODS; do
    echo "Logs for pod $pod:"
    kubectl logs $pod
done

echo "Blue-green deployment completed. Switch service to green when ready."